(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{22:function(e,t,a){e.exports=a(41)},27:function(e,t,a){},41:function(e,t,a){"use strict";a.r(t);var s=a(0),n=a.n(s),i=a(11),r=a.n(i),o=(a(27),a(4)),l=a(5),c=a(7),u=a(6),h=a(8),p=a(1),d=a(3),m=a(21);function b(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function f(e,t){var a=new Set(e),s=a.size;s<t&&(s=t);var n=s%5;0!==n&&(s+=5-n);for(var i=["a","e","i","o","u"],r=0;r<i.length&&a.size<s;r++)a.add(i[r]);for(var o=[["c","k"],["i","y"],["k","g"],["l","r"],["m","n"],["p","b"],["q","k"],["r","l"],["s","c"],["v","f"],["w","u"],["ph","f"]],l=0;l<o.length&&a.size<s;l++)e.indexOf(o[l][0])>=0&&a.add(o[l][1]);for(;a.size<s;)a.add(String.fromCharCode(b(97,117)));for(var c=Object(m.a)(a),u=c.length-1;u>0;u--){var h=c.splice(b(0,u),1);c.splice(u,0,h)}return c}function v(e,t){var a=0,s=!0,n=!1,i=void 0;try{for(var r,o=e[Symbol.iterator]();!(s=(r=o.next()).done);s=!0){(r.value.status&t)===t&&a++}}catch(l){n=!0,i=l}finally{try{s||null==o.return||o.return()}finally{if(n)throw i}}return a}var k=function(e){for(var t=new Array(e.total),a=0;a<e.total;a++)t[a]=n.a.createElement("span",{key:"el"+a,className:e.cur===a?"pagerel_active":"pagerel_blur"},"\u25cf");return n.a.createElement("div",{className:"pager_box"},t)},g={normal:-1,wrong:0,correct:1},y={dict:{no:1,yes:2},puzzle:{no:4,yes:8}},E={dict:{perf:30,flawed:15},puzzle:{perf:15,flawed:10}},O={error:"\u670d\u52a1\u5668\u541b\u9047\u5230\u4e86\u9ebb\u70e6 : (",nodata:"\u6682\u65f6\u6ca1\u6709\u4e1c\u897f\u8981\u5b66~~",timeout:"\u670d\u52a1\u5668\u541b\u4e45\u4e45\u4e0d\u7406\u6211\u4eec :(",loading:"\u6b63\u5728\u8f7d\u5165\u6570\u636e\u2026\u2026",uploading:"\u6b63\u5728\u4e0a\u4f20\u6570\u636e\u2026\u2026",rest:"\u4eca\u65e5\u4efd\u7ec3\u4e60\u5df2\u5b8c\u6210\uff0c\u4f11\u606f\u4e00\u4e0b\u5427\uff01",authFail:"\u767b\u5f55\u5931\u8d25\uff01\u8bf7\u68c0\u67e5\u7528\u6237\u540d\u548c\u5bc6\u7801",uploadFail:"\u4e0a\u4f20\u6570\u636e\u5931\u8d25",usernameInvalid:"\u7528\u6237\u540d\u987b\u4ee5\u5b57\u6bcd\u6216\u4e2d\u6587\u5f00\u5934\uff0c\u5305\u542b3-10\u4e2a\u5b57\u6bcd\u3001\u4e2d\u6587\u548c\u6570\u5b57",passwordInvalid:"\u5bc6\u7801\u5e94\u5305\u542b8-20\u4e2a\u5b57\u6bcd\u6216\u6570\u5b57",passwordConfirmFail:"\u4e24\u6b21\u8f93\u5165\u7684\u5bc6\u7801\u4e0d\u4e00\u81f4",usernameDuplicated:"\u7528\u6237\u540d\u5df2\u7ecf\u5b58\u5728"},j={notGoing:0,going:1,fail:2,done:3},x={username:/^([\u4E00-\u9FA5\uF900-\uFA2D]|[a-zA-Z]){1}([\u4E00-\u9FA5\uF900-\uFA2D]|[a-zA-Z0-9]){2,9}$/,password:/^[a-zA-Z0-9]{8,20}$/},w=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e="colorblack",t="genderless",a=this.props,s=a.achieve,i=a.status;return s===g.correct?i===y[this.props.kind].yes?(e="colorgold",t="star"):(e="colorred",t="check"):s===g.wrong&&(e="colorred",t="times"),n.a.createElement("div",{className:"composed_box"},n.a.createElement("div",{className:"composed_text"},this.props.composed),n.a.createElement("div",{className:"mark"},n.a.createElement(d.a,{icon:t,className:e})))}}]),t}(s.PureComponent),N=a(18),C=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={pos:0,achieve:g.normal,composed:"",animStatus:!0,reset:!1,tipping:!1},a.extra={status:y[e.kind].yes,animDur:1e3,enabled:!0,tips:""},a.player=n.a.createRef(),a.onChange=a.onChange.bind(Object(p.a)(Object(p.a)(a))),a.reflow=a.reflow.bind(Object(p.a)(Object(p.a)(a))),a.checkComposed=a.checkComposed.bind(Object(p.a)(Object(p.a)(a))),a.tip=a.tip.bind(Object(p.a)(Object(p.a)(a))),a.next=a.next.bind(Object(p.a)(Object(p.a)(a))),a.onNewTaskReady=a.onNewTaskReady.bind(Object(p.a)(Object(p.a)(a))),a.playSound=a.playSound.bind(Object(p.a)(Object(p.a)(a))),a.submit=a.submit.bind(Object(p.a)(Object(p.a)(a))),a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"onChange",value:function(e){this.extra.enabled&&this.setState({achieve:g.normal,composed:e})}},{key:"tip",value:function(){var e=this;if(this.extra.enabled){this.extra.status=y[this.props.kind].no;for(var t=this.state.composed,a=this.props.tasks[this.state.pos].keys,s=0,n=Math.min(t.length,a.length);s<n&&a[s]===t[s];s++);this.extra.tips=a.substring(0,s+1)+(s<a.length-1?"~":""),this.setState({tipping:!0}),setTimeout(function(){e.setState({tipping:!1})},1e3)}}},{key:"playSound",value:function(){var e=this.player.current;e&&e.play()}},{key:"reflow",value:function(){var e=this;this.extra.status=y[this.props.kind].yes,this.setState({achieve:g.normal,composed:"",animStatus:!0,reset:!0},function(){return e.setState({reset:!1})})}},{key:"submit",value:function(){if(this.extra.enabled){var e=this.checkComposed(this.state.composed);e===g.wrong&&(this.extra.status=y[this.props.kind].no);var t=!0;if(e===g.correct){var a=this.props.tasks[this.state.pos].status;this.props.tasks[this.state.pos].status=a|this.extra.status;var s=this.props.kind;this.props.addCoins(this.extra.status===y[s].yes?E[s].perf:E[s].flawed),t=!1,this.extra.enabled=!1}this.setState({achieve:e,animStatus:t})}}},{key:"checkComposed",value:function(e){return e===this.props.tasks[this.state.pos].keys?g.correct:g.wrong}},{key:"next",value:function(){var e=this.state.pos+1;e<this.props.tasks.length?this.setState({pos:e},this.reflow):this.props.next()}},{key:"onNewTaskReady",value:function(){this.playSound(),this.extra.enabled=!0}},{key:"render",value:function(){var e=this.props.tasks[this.state.pos],t=this.props.tip&&n.a.cloneElement(this.props.tip,{tipping:this.state.tipping,tips:this.extra.tips}),a=n.a.cloneElement(this.props.info,{task:e,playSound:this.playSound}),s=this.props.innerInput&&n.a.cloneElement(this.props.innerInput,{keys:e.keys,reset:this.state.reset,onChange:this.onChange,tip:this.tip,submit:this.submit}),i=this.props.outerInput&&n.a.cloneElement(this.props.outerInput,{keys:e.keys,reset:this.state.reset,onChange:this.onChange,tip:this.tip,submit:this.submit});return n.a.createElement("div",{className:"content bgpeace"},n.a.createElement("audio",{ref:this.player,src:"/sounds/"+e.audio}),n.a.createElement(k,{total:this.props.tasks.length,cur:this.state.pos}),n.a.createElement(N.CSSTransition,{timeout:this.extra.animDur,in:this.state.animStatus,appear:!0,classNames:"fade",onExited:this.next,onEntered:this.onNewTaskReady},n.a.createElement("div",{className:"min_page"},n.a.createElement(w,{composed:this.state.composed,achieve:this.state.achieve,status:this.extra.status,kind:this.props.kind}),t,a,s)),i)}}]),t}(s.PureComponent),S=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=n.a.createElement(T,null),t=n.a.createElement(z,null);return n.a.createElement(C,{tasks:this.props.taskData,next:this.props.next,addCoins:this.props.addCoins,kind:"puzzle",info:e,innerInput:t})}}]),t}(s.PureComponent);function T(e){return n.a.createElement(n.a.Fragment,null,n.a.createElement("h3",null,e.task.info),n.a.createElement("span",{className:"phonetic"},e.task.phonetic,n.a.createElement(d.a,{icon:"volume-up",className:"marginleft",onClick:e.playSound})))}var z=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={shuffled:f(e.keys,10)},a.composed="",a.onChar=a.onChar.bind(Object(p.a)(Object(p.a)(a))),a.backspace=a.backspace.bind(Object(p.a)(Object(p.a)(a))),a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"onChar",value:function(e){this.composed=this.composed+e,this.props.onChange(this.composed)}},{key:"backspace",value:function(){var e=this.composed,t=e.length;t>0&&(this.composed=e.slice(0,t-1),this.props.onChange(this.composed))}},{key:"componentDidUpdate",value:function(e){this.props.reset&&(this.setState({shuffled:f(this.props.keys,10)}),this.composed="")}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"puzzle_box"},this.state.shuffled.map(function(t,a){return n.a.createElement(_,{char:t,key:a,sendChar:e.onChar})}),n.a.createElement("button",{className:"btn_bkspc",onClick:this.backspace},n.a.createElement(d.a,{icon:"backspace"})),n.a.createElement("button",{className:"submit",onClick:this.props.submit},"\u63d0 \u4ea4"))}}]),t}(s.PureComponent),_=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).onClick=function(e){this.props.sendChar(this.props.char)},a.onClick=a.onClick.bind(Object(p.a)(Object(p.a)(a))),a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return n.a.createElement("button",{className:"puzzle_piece",onClick:this.onClick}," "===this.props.char?"\u3000":this.props.char)}}]),t}(s.PureComponent),D=S,A=a(19),F=a.n(A),I=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={pos:0,progress:0,showIndicator:!0,playAnim:!0},a.aniVars={reset:!0,startTime:0,intervalId:null},a.player=n.a.createRef(),a.next=a.next.bind(Object(p.a)(Object(p.a)(a))),a.playSound=a.playSound.bind(Object(p.a)(Object(p.a)(a))),a.tick=a.tick.bind(Object(p.a)(Object(p.a)(a))),a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"playSound",value:function(){var e=this.player.current;e&&e.play()}},{key:"tick",value:function(){if(this.aniVars.reset)this.setState({progress:100,playAnim:!0,showIndicator:!0}),this.aniVars.reset=!1,this.aniVars.startTime=(new Date).getTime();else{var e=this.aniVars.startTime;0!==e&&(new Date).getTime()-e>=3e3&&(this.setState({showIndicator:!1,progress:0,playAnim:!1}),this.aniVars.startTime=0)}}},{key:"next",value:function(){this.props.addCoins(5);var e=this.state.pos+1;e<this.props.taskData.length?(this.aniVars.reset=!0,this.aniVars.startTime=0,this.setState({pos:e,showIndicator:!0,progress:0,playAnim:!1},this.playSound)):this.props.next()}},{key:"componentDidMount",value:function(){this.playSound(),this.aniVars.intervalId=setInterval(this.tick,500)}},{key:"componentWillUnmount",value:function(){clearInterval(this.aniVars.intervalId)}},{key:"render",value:function(){var e=this.props.taskData[this.state.pos];return n.a.createElement("div",{className:"content bgpeace"},n.a.createElement(k,{total:this.props.taskData.length,cur:this.state.pos}),n.a.createElement("div",{className:"min_page"},n.a.createElement("div",{className:"learn_box"},n.a.createElement("audio",{ref:this.player,src:"/sounds/"+e.audio}),this.state.showIndicator?n.a.createElement("div",null,n.a.createElement(F.a,{animate:this.state.playAnim,animationDuration:"3s",responsive:!1,size:"70",lineWidth:"25",progress:this.state.progress,progressColor:"rgb(76, 154, 255)",bgColor:"#ecedf0",showPercentage:!1,showPercentageSymbol:!1})):n.a.createElement(n.a.Fragment,null,n.a.createElement("h2",null,e.keys),n.a.createElement("span",{className:"phonetic"},e.phonetic),n.a.createElement(d.a,{icon:"volume-up",className:"marginleft",onClick:this.playSound}))),n.a.createElement("div",{className:"fontlarge",style:{marginBottom:"2rem"}},e.info),n.a.createElement("div",null,n.a.createElement("button",{className:"primary",onClick:this.next},this.state.showIndicator?"\u6211\u4f1a\u5199":"\u4e0b\u4e00\u4e2a"))))}}]),t}(s.Component),M=a(20),P=a.n(M),R=(a(39),function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=n.a.createElement(V,null),t=n.a.createElement(U,null),a=n.a.createElement(K,null);return n.a.createElement(C,{tasks:this.props.taskData,next:this.props.next,addCoins:this.props.addCoins,kind:"dict",tip:e,info:t,outerInput:a})}}]),t}(s.PureComponent));function U(e){return n.a.createElement("h3",null,e.task.info)}function V(e){return n.a.createElement("div",{className:"tip "+(e.tipping?"elvisible":"elinvisible")},e.tips)}var K=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={layoutName:"default"},a.composed="",a.keyboard=n.a.createRef(),a.kblayout={default:["q w e r t y u i o p {bksp}","a s d f g h j k l & '","z x c v b n m , . {tips}","{shift} {space} {enter}"],shift:["Q W E R T Y U I O P {bksp}","A S D F G H J K L & '","Z X C V B N M , . {tips}","{shift} {space} {enter}"]},a.onKeyPress=a.onKeyPress.bind(Object(p.a)(Object(p.a)(a))),a.onChange=a.onChange.bind(Object(p.a)(Object(p.a)(a))),a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"onChange",value:function(e){this.composed=e,this.props.onChange(e)}},{key:"onKeyPress",value:function(e){"{enter}"===e?this.props.submit():"{tips}"===e?this.props.tip():"{shift}"===e&&this.setState({layoutName:"default"===this.state.layoutName?"shift":"default"})}},{key:"componentDidUpdate",value:function(e){this.props.reset&&(this.keyboard.current.clearInput(),this.composed="")}},{key:"render",value:function(){return n.a.createElement(P.a,{ref:this.keyboard,layout:this.kblayout,theme:"hg-theme-default monofont",display:{"{bksp}":"\u2190","{enter}":"\u63d0\u4ea4","{shift}":"\u5927\u5c0f\u5199","{tips}":"\u63d0\u3000\u793a"},mergeDisplay:!0,onChange:this.onChange,onKeyPress:this.onKeyPress,layoutName:this.state.layoutName,buttonTheme:[{class:"hg-button hg-standardBtn submit_key fontnormal",buttons:"{enter}"},{class:"hg-button hg-standardBtn fontnormal",buttons:"{shift} {tips} "}]})}}]),t}(s.PureComponent),G=R,B=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).start=a.start.bind(Object(p.a)(Object(p.a)(a))),a.toggleAnim=function(){return a.setState({anim:!a.state.anim})},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"start",value:function(){this.props.start()}},{key:"render",value:function(){return n.a.createElement("div",{className:"content bgpeace"},n.a.createElement("div",{className:"min_page"},n.a.createElement("h3",{style:{color:"#A26273"}},"\u6b22\u8fce\u4f60\uff0c",this.props.userName),n.a.createElement("h4",null,"\u4f60\u5df2\u7ecf\u5b66\u4e60",this.props.learned,"\u4e2a\uff0c\u8fd8\u9700\u5b66\u4e60",802-this.props.learned,"\u4e2a",n.a.createElement("br",null),n.a.createElement("br",null),"\u672c\u6b21\u8981\u5b66\u4e60",this.props.newTasks.length,"\u4e2a\u65b0\u5355\u8bcd:",n.a.createElement("br",null),this.props.newTasks.map(function(e){return e.keys}).join(" / "),n.a.createElement("br",null),n.a.createElement("br",null),"\u590d\u4e60",this.props.allTasks.length-this.props.newTasks.length,"\u4e2a\u5355\u8bcd\u3002"),n.a.createElement("div",{className:"margintop"},n.a.createElement("button",{className:"primary",onClick:this.start},"Let's Go\uff01"),n.a.createElement("button",{className:"marginleft primary",onClick:this.props.changeUser},"\u5207\u6362\u7528\u6237"))))}}]),t}(s.PureComponent);function J(e,t,a,s){return new Promise(function(n,i){var r=new XMLHttpRequest;r.timeout=1e4,r.open(t,e,!0),r.onload=function(e){n(this.responseText)},r.onerror=function(e){i("error")},r.ontimeout=function(e){i("timeout")};var o="text/plain;charset=utf-8";"json"===s?o="application/json;charset=utf-8":"xform"===s&&(o="application/x-www-form-urlencoded;charset=utf-8"),r.setRequestHeader("content-type",o),r.send(a)})}function q(e,t,a){return J(e,"POST",t,a)}var W=0,Z=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={type:W,validateRes:"\u3000"},a.login=a.login.bind(Object(p.a)(Object(p.a)(a))),a.alter=a.alter.bind(Object(p.a)(Object(p.a)(a))),a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=document.forms.logging.user_name;""!==this.props.curUser&&(e.value=this.props.curUser,e.readOnly=!0)}},{key:"validate",value:function(e,t,a){return x.username.test(e)?x.password.test(t)?a&&t!==a?O.passwordConfirmFail:"OK":O.passwordInvalid:O.usernameInvalid}},{key:"alter",value:function(){this.state.type===W?this.setState({type:1}):this.setState({type:W}),this.props.showMessage("")}},{key:"login",value:function(e){var t=this;e.preventDefault();var a=document.forms.logging,s=a.user_name.value,n=a.password.value,i="";"OK"===(i=this.state.type===W?this.validate(s,n):this.validate(s,n,a.confirm_password.value))?(this.setState({validateRes:"\u3000"}),q("/"+(this.state.type===W?"login":"logup"),JSON.stringify({name:s,password:n}),"json").then(function(e){"duplicated"===e?t.props.showMessage(O.usernameDuplicated):"OK"===e?(t.props.showMessage(""),t.props.after()):t.props.showMessage(O.authFail)},function(e){t.props.showMessage(O[e])})):this.setState({validateRes:i})}},{key:"render",value:function(){return n.a.createElement("div",{className:"content bgpeace"},n.a.createElement("div",{className:"min_page"},n.a.createElement("div",{className:"fontlarge marginbottom"},this.state.type===W?"\u767b\u3000\u5f55":"\u6ce8\u3000\u518c"),n.a.createElement("br",null),n.a.createElement("form",{name:"logging"},n.a.createElement("div",{className:"input_wrapper"},n.a.createElement("span",{className:"iconlabel"},n.a.createElement(d.a,{icon:"user"})),n.a.createElement("input",{className:"loginput",type:"text",name:"user_name",placeholder:"\u7528\u6237\u540d"})),n.a.createElement("div",{className:"input_wrapper"},n.a.createElement("span",{className:"iconlabel"},n.a.createElement(d.a,{icon:"key"})),n.a.createElement("input",{className:"loginput",type:"password",name:"password",placeholder:"\u5bc6\u7801"})),n.a.createElement("div",{className:"input_wrapper "+(1===this.state.type?"elvisible":"elinvisible")},n.a.createElement("span",{className:"iconlabel"}," ",n.a.createElement(d.a,{icon:"key"})),n.a.createElement("input",{className:"loginput",type:"password",name:"confirm_password",placeholder:"\u91cd\u590d\u5bc6\u7801"})),n.a.createElement("div",{className:"marginbottom fontsmall colorred"},this.state.validateRes),n.a.createElement("div",{className:"button_group"},n.a.createElement("button",{onClick:this.login,className:"primary"},this.state.type===W?"\u767b\u3000\u5f55":"\u6ce8\u3000\u518c"),""===this.props.curUser&&n.a.createElement("span",{className:"marginleft cursordefault fontsmall",onClick:this.alter},this.state.type===W?"\u6ce8  \u518c":"\u767b  \u5f55")))))}}]),t}(s.Component),H=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.puzzles.length,t=this.props.dictations.length,a=v(this.props.puzzles,y.puzzle.yes),s=v(this.props.dictations,y.dict.yes),i=this.props.uploadStatus,r=this.props.savedCoins+this.props.coins,o=Math.floor(Math.sqrt(2500+200*r-50)/100);return n.a.createElement("div",{className:"content bgpeace"},n.a.createElement("div",{className:"min_page"},i===j.going&&n.a.createElement(d.a,{icon:"spinner",className:"load_ani fontextralarge"}),i===j.fail&&n.a.createElement(d.a,{icon:"exclamation-triangle",className:"colorred fontextralarge"}),i===j.done&&n.a.createElement("div",null,n.a.createElement("h3",null,"\u4f60\u5df2\u5b8c\u6210\u672c\u8f6e\u7ec3\u4e60\uff01"),n.a.createElement("table",{cellPadding:"10px"},n.a.createElement("tbody",null,n.a.createElement("tr",null,n.a.createElement("td",null,"\u672c\u8f6e\u80dc\u7387")),n.a.createElement("tr",null,0!==e&&n.a.createElement("td",null,n.a.createElement(d.a,{icon:"puzzle-piece"})," ",a,"/",e," ",(a/e*100).toFixed(0),"%"),n.a.createElement("td",null,n.a.createElement(d.a,{icon:"keyboard"})," ",s,"/",t," ",(s/t*100).toFixed(0),"%")),n.a.createElement("tr",null,n.a.createElement("td",null,"\u83b7\u5f97\u8d22\u5bcc")),n.a.createElement("tr",null,n.a.createElement("td",null,n.a.createElement(d.a,{icon:"coins"})," ",this.props.coins,"\u4e2a"),n.a.createElement("td",null,n.a.createElement(d.a,{icon:"gem"})," ",this.props.diamonds,"\u4e2a")),n.a.createElement("tr",null,n.a.createElement("td",null,"\u76ee\u524d\u7ea7\u522b"),n.a.createElement("td",null,o,"\u7ea7")))),n.a.createElement("button",{className:"primary",onClick:this.props.nextrun},"\u518d\u6765\u4e00\u8f6e\u5427"),n.a.createElement("button",{className:"primary marginleft",onClick:this.props.doFallible},"\u590d\u4e60\u6613\u9519\u9898"))))}}]),t}(s.PureComponent),L=a(10),$=a(9);L.b.add($.j,$.d,$.f,$.k,$.b,$.l,$.n,$.a,$.m,$.g,$.i,$.h,$.e,$.c);var X=-3,Q=0,Y=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={stage:X,message:"",learned:0,diamonds:0,coins:0,uploadStatus:j.notGoing},a.extra={userName:"",afterAuth:null,diamonds_saved:0,coins_saved:0,tasksType:Q},a.taskDataArray=new Array(3),a.initTasks(),a.nextstage=a.nextstage.bind(Object(p.a)(Object(p.a)(a))),a.upload=a.upload.bind(Object(p.a)(Object(p.a)(a))),a.handleDataReceived=a.handleDataReceived.bind(Object(p.a)(Object(p.a)(a))),a.fetch=a.fetch.bind(Object(p.a)(Object(p.a)(a))),a.changeUser=a.changeUser.bind(Object(p.a)(Object(p.a)(a))),a.showMessage=a.showMessage.bind(Object(p.a)(Object(p.a)(a))),a.addCoins=a.addCoins.bind(Object(p.a)(Object(p.a)(a))),a.nextrun=a.nextrun.bind(Object(p.a)(Object(p.a)(a))),a.doFallible=a.doFallible.bind(Object(p.a)(Object(p.a)(a))),a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"handleDataReceived",value:function(e){var t=null;try{t=JSON.parse(e)}catch(a){return void this.setState({message:O.error})}this.sortup(t.data),this.extra.userName=t.username,this.extra.diamonds_saved=t.diamonds,this.extra.coins_saved=t.coins,this.setState({stage:-1,learned:t.learned,coins:0,diamonds:0})}},{key:"fetch",value:function(){var e=this;this.extra.afterAuth=this.fetch,this.initTasks();var t,a=1===this.extra.tasksType?"fallible.json":"data.json";(t="/"+a,J(t,"GET")).then(function(t){if("unauth"===t)return e.extra.afterAuth=e.fetch,void e.setState({stage:-2});"nodata"!==t?e.handleDataReceived(t):e.setState({message:O.nodata})},function(t){e.setState({message:O[t]})})}},{key:"upload",value:function(){var e=this;this.extra.afterAuth=this.upload;var t=[],a=!0,s=!1,n=void 0;try{for(var i,r=this.dictationTasks[Symbol.iterator]();!(a=(i=r.next()).done);a=!0){var o=i.value;t.push({taskid:o.taskid,status:o.status,lastrec:o.lastrec})}}catch(l){s=!0,n=l}finally{try{a||null==r.return||r.return()}finally{if(s)throw n}}this.setState({message:O.uploading,uploadStatus:j.going}),q("/submit",JSON.stringify({username:this.extra.userName,coins:this.state.coins,diamonds:this.state.diamonds,recs:t}),"json").then(function(t){"OK"===t?e.setState({message:"",uploadStatus:j.done}):"unauth"===t?e.setState({message:"",stage:-2}):e.setState({message:O.uploadFail,uploadStatus:j.fail})},function(t){e.setState({message:O[t],uploadStatus:j.fail})})}},{key:"initTasks",value:function(){this.learnTasks=[],this.puzzleTasks=[],this.dictationTasks=[],this.taskDataArray[0]=this.learnTasks,this.taskDataArray[1]=this.puzzleTasks,this.taskDataArray[2]=this.dictationTasks}},{key:"sortup",value:function(e){var t=!0,a=!1,s=void 0;try{for(var n,i=e[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var r=n.value;r.status=0,0===r.kind?(this.learnTasks.push(r),this.puzzleTasks.push(r),this.dictationTasks.push(r)):1===r.kind?(this.puzzleTasks.push(r),this.dictationTasks.push(r)):2===r.kind&&this.dictationTasks.push(r)}}catch(o){a=!0,s=o}finally{try{t||null==i.return||i.return()}finally{if(a)throw s}}}},{key:"changeUser",value:function(){this.extra.userName="",this.extra.afterAuth=this.fetch,this.extra.tasksType=Q,this.setState({stage:-2})}},{key:"nextstage",value:function(){var e=this,t=this.state.stage,a=this.state.diamonds;for(1===t&&v(this.puzzleTasks,y.puzzle.yes)===this.puzzleTasks.length?a+=1:2===t&&v(this.dictationTasks,y.dict.yes)===this.dictationTasks.length&&(a+=2);t<3&&3!==++t&&!(this.taskDataArray[t].length>0););this.setState({diamonds:a,stage:t},function(){3===t&&e.upload()})}},{key:"nextrun",value:function(){this.setState({stage:X,message:"",uploadStatus:j.notGoing}),this.extra.tasksType=Q,this.fetch()}},{key:"doFallible",value:function(){this.setState({stage:X,message:"",uploadStatus:j.notGoing}),this.extra.tasksType=1,this.fetch()}},{key:"showMessage",value:function(e){this.setState({message:e})}},{key:"addCoins",value:function(e){var t=this.state.coins+e;this.setState({coins:t})}},{key:"componentDidMount",value:function(){this.fetch()}},{key:"render",value:function(){var e=null;switch(this.state.stage){case X:e=n.a.createElement("div",{className:"content bgpeace"},n.a.createElement("div",{className:"min_page fontextralarge"},""===this.state.message?n.a.createElement(d.a,{icon:"spinner",className:"load_ani"}):n.a.createElement(n.a.Fragment,null,n.a.createElement(d.a,{icon:"exclamation-triangle",className:"colorred"}),1===this.extra.tasksType&&n.a.createElement("div",null,n.a.createElement("button",{className:"primary",onClick:this.nextrun},"\u505a\u666e\u901a\u4efb\u52a1")))));break;case-2:e=n.a.createElement(Z,{after:this.extra.afterAuth,curUser:this.extra.userName,showMessage:this.showMessage});break;case-1:e=n.a.createElement(B,{start:this.nextstage,userName:this.extra.userName,newTasks:this.learnTasks,allTasks:this.dictationTasks,changeUser:this.changeUser,learned:this.state.learned});break;case 0:e=n.a.createElement(I,{next:this.nextstage,addCoins:this.addCoins,taskData:this.learnTasks});break;case 1:e=n.a.createElement(D,{next:this.nextstage,addCoins:this.addCoins,taskData:this.puzzleTasks});break;case 2:e=n.a.createElement(G,{next:this.nextstage,addCoins:this.addCoins,taskData:this.dictationTasks});break;case 3:e=n.a.createElement(H,{uploadStatus:this.state.uploadStatus,puzzles:this.puzzleTasks,dictations:this.dictationTasks,nextrun:this.nextrun,doFallible:this.doFallible,coins:this.state.coins,diamonds:this.state.diamonds,savedCoins:this.extra.coins_saved})}return n.a.createElement("div",{className:"app"},n.a.createElement("div",{className:"header colorwhite"},n.a.createElement(d.a,{icon:"coins"})," ",this.extra.coins_saved+this.state.coins,n.a.createElement(d.a,{icon:"gem",className:"marginleft"})," ",this.extra.diamonds_saved+this.state.diamonds),this.state.message&&n.a.createElement("div",{className:"bgwarn message_bar"},this.state.message),e)}}]),t}(s.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(n.a.createElement(Y,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[22,2,1]]]);
//# sourceMappingURL=main.a40493c7.chunk.js.map